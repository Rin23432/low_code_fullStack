# 🚀 BFF 层快速测试指南

## 快速开始

### 方法 1: 使用启动脚本 (推荐)

```bash
# Windows 用户
双击 start-test.bat

# 或者手动运行
npm install
npm run dev
```

### 方法 2: 手动启动

```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev

# 3. 访问测试页面
```

## 🧪 测试页面

### 答题页面测试

- **URL**: `http://localhost:3000/question/1`
- **功能**: 显示问卷内容，支持答案提交
- **SSR**: ✅ 已启用
- **特性**: 服务端预渲染，首屏加载优化

## 📊 性能监控

每个页面都集成了性能监控组件，显示：

- **SSR 渲染时间**: 服务端渲染耗时
- **客户端渲染时间**: 浏览器渲染耗时
- **水合时间**: React 水合完成时间
- **网络性能指标**: DNS、TCP、响应时间等
- **性能等级**: A/B/C/D 评级
- **优化建议**: 基于性能数据的改进建议

## 🔧 API 测试

### 使用测试脚本

```bash
# 在另一个终端运行
node test-bff.js
```

### 手动测试 API

```bash
# 问题列表
curl http://localhost:3000/api/question/list

# 问题详情
curl http://localhost:3000/api/question/1



# 提交答案
curl -X POST http://localhost:3000/api/answer \
  -H "Content-Type: application/json" \
  -d '{"questionId":"1","c1":"test","c2":"满意"}'
```

## 🎯 验证要点

### 1. BFF 层功能

- [ ] API 请求正常响应
- [ ] CORS 头设置正确
- [ ] 错误处理完善
- [ ] 请求转发正常

### 2. SSR 功能

- [ ] 页面首屏加载快速
- [ ] 服务端预渲染正常
- [ ] 性能监控显示正确
- [ ] 水合过程顺畅

### 3. 跨域解决

- [ ] 前端无跨域错误
- [ ] API 调用成功
- [ ] 响应头设置正确

### 4. 性能优化

- [ ] 首屏加载时间 < 500ms
- [ ] SSR 渲染时间 < 300ms
- [ ] 客户端渲染时间 < 200ms

## 🐛 常见问题

### Q: 页面显示 "获取问题数据失败"

**A**: 检查后端服务是否运行在 3001 端口，或修改 `.env.local` 中的 `BACKEND_HOST`

### Q: API 返回 404 错误

**A**: 确保开发服务器已启动，检查 API 路由文件是否正确创建

### Q: 样式不显示

**A**: 确保 SCSS 依赖已安装，检查样式文件路径

### Q: 性能监控不显示数据

**A**: 等待页面完全加载，检查浏览器控制台是否有错误

## 📈 性能基准

| 指标           | 优秀    | 良好    | 一般    | 需要优化 |
| -------------- | ------- | ------- | ------- | -------- |
| SSR 渲染时间   | < 100ms | < 300ms | < 500ms | > 500ms  |
| 客户端渲染时间 | < 100ms | < 200ms | < 300ms | > 300ms  |
| 首屏加载时间   | < 300ms | < 500ms | < 800ms | > 800ms  |

## 🔍 调试技巧

1. **查看控制台**: 检查 SSR 日志和错误信息
2. **网络面板**: 观察 API 请求和响应
3. **性能面板**: 分析渲染时间和资源加载
4. **SSR 调试**: 查看服务端渲染的 HTML 源码

## 📝 测试报告模板

```
测试时间: _______________
测试环境: _______________

✅ 通过测试:
- BFF API 响应正常
- SSR 渲染成功
- 性能监控显示正确
- 跨域问题已解决

⚠️ 需要注意:
- [具体问题]

📊 性能数据:
- SSR 渲染时间: ___ ms
- 客户端渲染时间: ___ ms
- 首屏加载时间: ___ ms

🎯 优化建议:
- [具体建议]
```

## 🎉 成功标志

当看到以下内容时，说明 BFF 层实现成功：

1. ✅ 页面正常加载，无跨域错误
2. ✅ 性能监控面板显示完整数据
3. ✅ SSR 渲染时间在合理范围内
4. ✅ API 测试脚本运行成功
5. ✅ 答题页面功能正常

---

**Happy Testing! 🚀**
